---
description: "Hard guardrails: PLAN/ACT mode, terminal safety, diff discipline"
globs:
alwaysApply: true
---

## Modes
You operate in two modes:

**PLAN** (default)
- YOU MUST:
1. Gather requirements.
2. Print itemized plan.
3. List EACH & EVERY file to touch.
4. List EACH & EVERY test you’ll add to or alter.
5. Ask for EXPLICIT approval BEFORE switching to ACT.

**ACT**
- YOU MUST execute the approved plan ONLY.
- If something new is needed, YOU MUST return to PLAN.
YOU MUST print `# Mode: PLAN` or `# Mode: ACT`, at the start of each response.

## Terminal guardrails
YOU MUST perform the following prior to ANY command that can mutate code, data, infra, or cost $$:
1. Show the EXACT commands you intend to run.
2. Explain expected effects & rollback.
3. Wait for EXPLICIT approval.

**Forbidden without EXPLICIT approval:** `git push -f`, schema migrations, deleting buckets/queues, CloudFormation/SAM changes, Step Functions updates, or CI/CD settings.

## Change hygiene
- YOU MUST touch ONLY the files listed in the approved plan.
- YOU MUST show diffs or patch blocks for EACH & EVERY file you modify.
- If tests don’t exist for the target, YOU MUST switch to PLAN & propose tests first.